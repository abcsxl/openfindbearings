# OpenFindBearing æ¶æ„è®¾è®¡æ–‡æ¡£

> **é¡¹ç›®å£å·**ï¼šå¼€æº Â· æ‰¾è½´æ‰¿ â€”â€” è®©å·¥ä¸šå“äº¤æ˜“æ›´ç®€å•  
> **æŠ€æœ¯åŸºè°ƒ**ï¼šå•ä½“åº”ç”¨èµ·æ­¥ï¼Œæ¨¡å—åŒ–åˆ†å±‚ï¼Œæ•°æ®é©±åŠ¨æ¼”è¿›  
> **æ ¸å¿ƒç†å¿µ**ï¼šå…ˆæ¶ˆæ¯åˆ†äº«ï¼Œå†ç”¨è¡Œä¸ºæ•°æ®èµ‹èƒ½æ™ºèƒ½æ’®åˆ

---

## ä¸€ã€æŠ€æœ¯æ ˆé€‰å‹

| å±‚çº§ | æŠ€æœ¯ | ç‰ˆæœ¬/è¯´æ˜ |
|------|------|----------|
| åç«¯æ¡†æ¶ | ASP.NET Core Web API | .NET 10 (æˆ– .NET 8 LTS) |
| ORM | Entity Framework Core | Code First æ¨¡å¼ |
| æ•°æ®åº“ | MySQL | 8.0+ï¼Œä½¿ç”¨ `Pomelo.EntityFrameworkCore.MySql` é©±åŠ¨ |
| ç¼“å­˜ | Redis | å¯é€‰ï¼Œç”¨äº Tokenã€çƒ­ç‚¹æ•°æ®ç¼“å­˜ |
| å‰ç«¯ | å¾®ä¿¡å°ç¨‹åº | åŸç”Ÿå¼€å‘ï¼ˆWXML + TypeScriptï¼‰ |
| æ¥å£è§„èŒƒ | RESTful + JSON | ç»Ÿä¸€å“åº”æ ¼å¼ `{ code, msg, data }` |
| æ–‡æ¡£ | Swagger / NSwag | è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£ |
| éƒ¨ç½² | Docker | ä¾¿äºç¯å¢ƒä¸€è‡´æ€§ |

> ğŸ’¡ **ä¸ºä»€ä¹ˆä¸ç”¨ PostgreSQLï¼Ÿ**  
> è™½ç„¶ PG åŠŸèƒ½å¼ºå¤§ï¼Œä½†æœ¬é¡¹ç›®ä»¥ç»“æ„åŒ–ä¸šåŠ¡æ•°æ®ä¸ºä¸»ï¼ˆç”¨æˆ·ã€æ¶ˆæ¯ã€è¡Œä¸ºï¼‰ï¼ŒMySQL åœ¨ .NET ç”Ÿæ€ä¸­é›†æˆæ›´æˆç†Ÿã€è¿ç»´æˆæœ¬æ›´ä½ï¼Œç¬¦åˆâ€œå¿«é€ŸéªŒè¯â€åŸåˆ™ã€‚

---

## äºŒã€æ•´ä½“æ¶æ„é£æ ¼

é‡‡ç”¨ **Clean Architecture ç²¾ç®€ç‰ˆ**ï¼Œç‰©ç†ä¸Šä¸ºå•ä½“åº”ç”¨ï¼ˆä¸€ä¸ª `.csproj`ï¼‰ï¼Œé€»è¾‘ä¸Šä¸¥æ ¼åˆ†å±‚ï¼š

OpenFindBearing.Api/  
â”œâ”€â”€ Controllers/     # HTTP å…¥å£ï¼Œå¤„ç†è·¯ç”±ä¸ DTO è½¬æ¢  
â”œâ”€â”€ Application/     # åº”ç”¨æœåŠ¡å±‚ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰  
â”‚ â”œâ”€â”€ Services/      # ä¸šåŠ¡æœåŠ¡
â”‚ â””â”€â”€ DTOs/          # æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆå‰åç«¯äº¤äº’æ¨¡å‹ï¼‰  
â”œâ”€â”€ Domain/          # é¢†åŸŸæ¨¡å‹ï¼ˆæ ¸å¿ƒå®ä½“ï¼‰  
â”‚ â””â”€â”€ Entities/      # EF Core å®ä½“ç±»ï¼ˆå¦‚ User, Messageï¼‰  
â”œâ”€â”€ Infrastructure/  # åŸºç¡€è®¾æ–½  
â”‚ â”œâ”€â”€ Persistence/   # DbContext ä¸ Repository å®ç°  
â”‚ â””â”€â”€ External/      # å¤–éƒ¨æœåŠ¡ï¼ˆå¾®ä¿¡APIã€AIæ¥å£ç­‰ï¼‰  
â””â”€â”€ Program.cs       # ä¾èµ–æ³¨å…¥ä¸å¯åŠ¨é…ç½®  

> âœ… **ä¼˜åŠ¿**ï¼š  
> - ä»£ç é«˜å†…èšã€ä½è€¦åˆ  
> - æœªæ¥è‹¥éœ€æ‹†å¾®æœåŠ¡ï¼Œåªéœ€æŒ‰æ¨¡å—åˆ‡åˆ†é¡¹ç›®  
> - å•å…ƒæµ‹è¯•å‹å¥½

---

## ä¸‰ã€æ ¸å¿ƒæ¨¡å—ä¸ API è®¾è®¡

æ‰€æœ‰åŠŸèƒ½å›´ç»• **â€œæ¶ˆæ¯å‘å¸ƒ â†’ è¡Œä¸ºè®°å½• â†’ æ™ºèƒ½åé¦ˆâ€** é—­ç¯å±•å¼€ã€‚

### 1. ç”¨æˆ·è®¤è¯æ¨¡å—
- **å…¥å£**ï¼š`POST /api/auth/login`
- **æµç¨‹**ï¼šå°ç¨‹åºä¼  `code` â†’ åç«¯è°ƒå¾®ä¿¡æ¥å£æ¢ `openid` â†’ è‡ªåŠ¨æ³¨å†Œ/ç™»å½• â†’ è¿”å› JWT Token
- **å®ä½“**ï¼š`User`

### 2. ä¾›æ±‚æ¶ˆæ¯æ¨¡å—ï¼ˆMVP æ ¸å¿ƒï¼‰
- **å®ä½“**ï¼š`Message`
- **å…³é”®å­—æ®µ**ï¼š
  ```csharp
  public string Title { get; set; }     // å¦‚ "æ±‚è´­6201"
  public string Content { get; set; }   // è¯¦æƒ…æè¿°
  public int Type { get; set; }         // 0=æ±‚è´­, 1=ä¾›åº”
  public string Spec { get; set; }      // æ ‡å‡†åŒ–å‹å·ï¼ˆä¾›AIæå–åå¡«å……ï¼‰
 â€‹```
* **API**ï¼š
  * `POST /api/messages` **â†’ å‘å¸ƒ**
  * `GET /api/messages` **â†’ åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€ç±»å‹ç­›é€‰ï¼‰**
  * `GET /api/messages/{id}` **â†’ è¯¦æƒ…**

### 3. ç”¨æˆ·è¡Œä¸ºä¸ä¿¡ç”¨ä½“ç³»

* **å®ä½“**ï¼š`UserAction`
* **è®°å½•åŠ¨ä½œ**ï¼šæµè§ˆã€å·¦æ»‘ï¼ˆä¸æ„Ÿå…´è¶£ï¼‰ã€å³æ»‘ï¼ˆæ„Ÿå…´è¶£ï¼‰ã€æ‹¨æ‰“ç”µè¯ã€ä¸¾æŠ¥
* **ä¿¡ç”¨åˆ†è®¡ç®—**ï¼šåœ¨ `UserService` ä¸­å®ç°è§„åˆ™å¼•æ“ï¼ˆå¦‚ï¼šå“åº”å¿« + è¢«ç‚¹â€œæ„Ÿå…´è¶£â€å¤š = é«˜åˆ†ï¼‰
* **API**ï¼š
  * `POST /api/actions` **â†’ æäº¤è¡Œä¸º**
  * `GET /api/users/{id}/credit` **â†’ è·å–ä¿¡ç”¨åˆ†**

### 4. æ™ºèƒ½æ¨èä¸æ•°æ®äº§å“ï¼ˆæ¼”è¿›æ–¹å‘ï¼‰

**è¡¨æ ¼**

| **åŠŸèƒ½**      | **API è·¯å¾„**                        | **è¯´æ˜**                          |
| ------------- | ----------------------------------- | --------------------------------- |
| **æ¨èæµ**    | `GET /api/recommend/feed`           | **åŸºäºååŒè¿‡æ»¤æˆ–çƒ­é—¨æ’åº**        |
| **å†·é—¨å¯»å®**  | `POST /api/messages/treasure-hunt`  | **ç‰¹æ®Šæ ‡è®°ï¼Œå®šå‘æ¨é€**            |
| **ä»·æ ¼æŒ‡æ•°**  | `GET /api/pricing/index?model=6201` | **æŒ‰å‹å·èšåˆæŠ¥ä»·**                |
| **çƒ­åº¦æ¦œå•**  | `GET /api/stats/rankings`           | **æ—¥/å‘¨çƒ­é—¨å‹å· Top10**           |
| **AI ç»“æ„åŒ–** | `POST /api/ai/parse`                | **è¾“å…¥æ–‡æœ¬ï¼Œè¾“å‡ºæ ‡å‡†åŒ–å‹å·+å‚æ•°** |

> **âš ï¸** **èµ·æ­¥ç­–ç•¥**ï¼š
> ä¸Šè¿°æ™ºèƒ½æ¥å£åˆæœŸå¯è¿”å› mock æ•°æ®æˆ–ç®€å• SQL èšåˆç»“æœï¼Œ**é‡ç‚¹æ˜¯æŠŠè¡Œä¸ºæ•°æ®ï¼ˆUserActionï¼‰åŸ‹ç‚¹åšå…¨****ã€‚**

---

## å››ã€æ•°æ®åº“ç­–ç•¥ï¼šCode First å…¨æµç¨‹

1. **å®šä¹‰å®ä½“ç±»**ï¼ˆå¦‚ `Message.cs`ï¼‰
2. **é…ç½® DbContext**
   **csharp**
   
   ```csharp
   public class AppDbContext : DbContext
   {
       public DbSet<User> Users { get; set; }
       public DbSet<Message> Messages { get; set; }
       public DbSet<UserAction> UserActions { get; set; }
   }
   ```
3. **å¯ç”¨è¿ç§»**

   ```bash
   dotnet ef migrations add InitialCreate
   dotnet ef database update
   ```
4. **EF Core è‡ªåŠ¨åˆ›å»ºè¡¨ï¼Œæ— éœ€æ‰‹å†™ SQLã€‚**

> **âœ…** **ä¼˜åŠ¿**ï¼š
> 
> * **æ•°æ®åº“ç»“æ„ä¸ä»£ç åŒæ­¥**
> * **æ”¯æŒç‰ˆæœ¬å›æ»šï¼ˆMigrationï¼‰**
> * **å¼€å‘è€…åªéœ€å…³æ³¨ C# æ¨¡å‹**

---

## äº”ã€æ¼”è¿›è·¯çº¿å›¾

**è¡¨æ ¼**

| **é˜¶æ®µ**                          | **ç›®æ ‡**                           | **æŠ€æœ¯é‡ç‚¹**                           |
| --------------------------------- | ---------------------------------- | -------------------------------------- |
| **Phase 1ï¼šä¿¡æ¯å‘å¸ƒ** | **è·‘é€šâ€œå‘æ¶ˆæ¯-çœ‹æ¶ˆæ¯â€é—­ç¯**       | **å¾®ä¿¡ç™»å½•ã€æ¶ˆæ¯CRUDã€åŸºç¡€æœç´¢**       |
| **Phase 2ï¼šä¿¡ä»»æ’®åˆ** | **å¼•å…¥ä¿¡ç”¨åˆ†ã€åœ¨çº¿æ²Ÿé€šã€æ‹…ä¿æ„å‘** | **è¡Œä¸ºåŸ‹ç‚¹ã€ä¿¡ç”¨ç®—æ³•ã€IM é›†æˆ**        |
| **Phase 3ï¼šç”Ÿæ€èµ‹èƒ½** | **æä¾›é‡‘èã€é›†é‡‡ã€å±¥çº¦æœåŠ¡**      | **äº¤æ˜“é—­ç¯ã€ä¾›åº”é“¾é‡‘èã€API å¼€æ”¾å¹³å°**  |

> **ğŸ”‘** **ç»ˆæç†è§£**ï¼š
> ä¸å–è´§æ¶ï¼Œè€Œå– **â€œç¡®å®šæ€§è§£å†³æ–¹æ¡ˆâ€****ï¼ˆæˆ‘èƒ½ç¡®ä¿ä½ ä¹°åˆ°å¯¹çš„è´§ï¼‰ã€‚**